{"version":3,"sources":["uni-app:///main.js","webpack:////Users/lenyue/www/51deng/1uniapp/pages/message/service.vue?c213","webpack:////Users/lenyue/www/51deng/1uniapp/pages/message/service.vue?d7a1","webpack:////Users/lenyue/www/51deng/1uniapp/pages/message/service.vue?a768","webpack:////Users/lenyue/www/51deng/1uniapp/pages/message/service.vue?7c8d","uni-app:///pages/message/service.vue","webpack:////Users/lenyue/www/51deng/1uniapp/pages/message/service.vue?fada","webpack:////Users/lenyue/www/51deng/1uniapp/pages/message/service.vue?7854"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,mG;AACAA,UAAU,CAACC,gBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoH;AACpH;AAC2D;AACL;AACc;;;AAGpE;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,kFAAM;AACR,EAAE,2FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAq0B,CAAgB,qyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC0Mz1B;AACA,gD;AACA;AACA;AACA;AADA,GADA;AAIA,MAJA,kBAIA;AACA;AACA,qBADA;AAEA,sBAFA;AAGA,uBAHA;AAIA;AACA;AACA,iBANA;AAOA;AACA,6BARA;AASA,4BATA;AAUA,kBAVA;AAWA,sBAXA;AAYA,iBAZA;AAaA;AACA,cAdA;;AAgBA;;AAEA;AACA,wCAnBA;;AAqBA,oBArBA;AAsBA,uBAtBA;AAuBA,4BAvBA;AAwBA,sBAxBA;AAyBA,qBAzBA;AA0BA,wCA1BA;AA2BA,uBA3BA;AA4BA,qBA5BA;;AA8BA;AACA,0CA/BA;AAgCA,qBAhCA;AAiCA,sBAjCA;AAkCA;AACA,yBAnCA;AAoCA;AACA,oBArCA;AAsCA;AACA,qBAvCA;AAwCA,qBAxCA;AAyCA,mBAzCA;AA0CA;AACA,qBA3CA;AA4CA;AACA,sBA7CA;AA8CA;AACA,iBADA,EACA;AACA,kBAFA;AAGA,kBAHA;AAIA,sBAJA;AAKA,mBALA,EA9CA;;;AAsDA,GA3DA;AA4DA,QA5DA,kBA4DA,MA5DA,EA4DA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAvEA;;AAyEA,QAzEA,oBAyEA;AACA;;AAEA;AACA;AACA,4BADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAVA;;AAYA,GAzFA;AA0FA;AACA,YADA,sBACA;AACA;AACA;AACA;AACA,KALA;AAMA,kBANA,4BAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAbA;AAcA,aAdA,qBAcA,GAdA,EAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBANA;;AAQA,OATA,MASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAZA;;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA;AAIA,KArDA;AAsDA;AACA,eAvDA,uBAuDA,CAvDA,EAuDA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OATA,EASA,IATA;AAUA;AACA;AACA,mCA5BA,CA4BA;AACA,mCA7BA,CA6BA;AACA,0CA9BA,CA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AANA,SAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,6CADA,CACA;AACA;AACA,wCADA,CACA;AACA,WAFA;;AAIA,SANA;AAOA;;AAEA,OAlCA,EAkCA,IAlCA;AAmCA,KA1HA;AA2HA;AACA,cA5HA,wBA4HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AAcA;AACA;AACA,oFADA;AAEA,qLAFA;AAGA,iOAHA;AAIA,2NAJA;AAKA,6MALA;AAMA,kNANA;AAOA,wNAPA;AAQA,oFARA;;AAUA,kGAVA;AAWA,sOAXA;AAYA,kOAZA;;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;;AAIA,OAPA;AAQA,KAjLA;AAkLA;AACA,cAnLA,sBAmLA,OAnLA,EAmLA;AACA;AACA,iCAFA,CAEA;AACA,iCAHA,CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA7LA;;AA+LA;AACA,YAhMA,sBAgMA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA,KAzMA;AA0MA;AACA,cA3MA,wBA2MA;AACA;AACA,KA7MA;AA8MA;AACA,cA/MA,wBA+MA;AACA;AACA;AACA;AACA;AACA,OAHA,EAGA,GAHA;AAIA,KArNA;AAsNA;AACA,oBAvNA,8BAuNA;AACA;AACA,8BADA;;AAGA;AACA,KA5NA;AA6NA;AACA,eA9NA,uBA8NA,IA9NA,EA8NA;AACA;AACA;AACA,0BADA;AAEA,4CAFA,EAEA;AACA;AACA;AACA,wCADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAJA,EAIA,KAJA,CAIA;AACA;AACA,eANA;;AAQA,aAZA;;AAcA,SAlBA;;AAoBA,KApPA;;;AAuPA;AACA,iBAxPA,2BAwPA;AACA;AACA;AACA;AACA,KA5PA;AA6PA;AACA,YA9PA,sBA8PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAtQA;AAuQA;AACA,gBAxQA,wBAwQA,GAxQA,EAwQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAnBA;AAoBA;AACA,KA/RA;;AAiSA;AACA,WAlSA,mBAkSA,OAlSA,EAkSA,IAlSA,EAkSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA1SA;;AA4SA;AACA,cA7SA,sBA6SA,GA7SA,EA6SA;AACA;AACA,KA/SA;AAgTA;AACA,eAjTA,uBAiTA,GAjTA,EAiTA;AACA;AACA,KAnTA;AAoTA;AACA,aArTA,qBAqTA,GArTA,EAqTA;AACA;AACA;AACA;AACA,KAzTA;AA0TA,qBA1TA,6BA0TA,GA1TA,EA0TA;AACA;AACA,KA5TA;AA6TA;AACA,oBA9TA,4BA8TA,GA9TA,EA8TA;AACA;AACA,KAhUA;AAiUA;AACA,2BAlUA,mCAkUA,GAlUA,EAkUA;AACA;AACA,KApUA;AAqUA;AACA,mBAtUA,2BAsUA,GAtUA,EAsUA,KAtUA,EAsUA;AACA;AACA;AACA,uBADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,kBADA,EACA;AACA,uBAFA;AAGA,gDAHA;AAIA,iCAJA;AAKA,wBALA;;AAOA,SARA,MAQA;AACA;AACA,kBADA,EACA;AACA,2BAFA;AAGA,kDAHA;AAIA,4BAJA;AAKA,yBALA;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OA5BA,EA4BA,GA5BA;;AA8BA,KA3WA;AA4WA;AACA,oBA7WA,8BA6WA;AACA;AACA;AACA;AACA,OAFA,EAEA,GAFA;AAGA,KAlXA;AAmXA,iBAnXA,yBAmXA,OAnXA,EAmXA,IAnXA,EAmXA;AACA;AACA;AACA;AACA;AACA,KAxXA;AAyXA;AACA,aA1XA,qBA0XA,GA1XA,EA0XA;AACA;AACA,+CADA;;AAGA,KA9XA;AA+XA;AACA,WAhYA,mBAgYA,GAhYA,EAgYA;AACA;AACA,yBADA;AAEA,gCAFA;AAGA,6BAHA;;AAKA,KAtYA;AAuYA;AACA,aAxYA,qBAwYA,GAxYA,EAwYA;AACA;AACA;AACA;AACA;AACA,OAFA;AAGA,KA9YA;AA+YA;AACA,cAhZA,sBAgZA,CAhZA,EAgZA;AACA;AACA;AACA;AACA,qBADA;AAEA,sCAFA;AAGA;AACA;AACA;AACA;AACA,aAHA,MAGA;AACA;AACA;AACA;AACA,WAXA;;AAaA,OAdA,MAcA;AACA;AACA,qBADA;AAEA,sCAFA;AAGA;AACA;AACA;AACA;AACA,aAHA,MAGA;AACA;AACA;AACA;AACA,WAXA;;AAaA,OAdA,MAcA;AACA;AACA;AACA;AACA;AACA;;AAEA,KArbA;AAsbA;AACA,eAvbA,uBAubA,CAvbA,EAubA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KA9bA;AA+bA;AACA,eAhcA,yBAgcA;AACA;AACA;AACA;AACA,2BAJA,CAIA;AACA,2BALA,CAKA;AACA,KAtcA;AAucA;AACA,YAxcA,oBAwcA,CAxcA,EAwcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA,KAndA;AAodA;AACA,YArdA,oBAqdA,CArdA,EAqdA;AACA;AACA;AACA;AACA;AACA;AACA,KA3dA;AA4dA;AACA,aA7dA,qBA6dA,CA7dA,EA6dA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAVA;AAWA,SAfA,EAeA,KAfA,CAeA;AACA;AACA;AACA,SAlBA;AAmBA,OApBA,MAoBA;AACA;AACA;AACA;AACA,KAvfA;AAwfA;AACA,eAzfA,yBAyfA;AACA;AACA;AACA,KA5fA;AA6fA,WA7fA,qBA6fA;AACA;AACA,KA/fA,EA1FA;;AA2lBA;AACA,cADA,wBACA;AACA;AACA;AACA;AACA,OAFA;AAGA;AACA,KAPA;AAQA,sCARA;AASA,qCATA,CA3lBA;;AAsmBA;AACA;AACA,aADA,mBACA,MADA,EACA,MADA,EACA;AACA;AACA;AACA;AACA,SAHA;AAIA,OANA;AAOA,qBAPA;AAQA,gBARA,EADA;;;AAYA,WAZA,mBAYA,MAZA,EAYA,MAZA,EAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAJA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAJA;AAKA,OANA,EAMA,CANA;;AAQA,KAhCA;AAiCA,cAjCA,sBAiCA,MAjCA,EAiCA,MAjCA,EAiCA;AACA;AACA;AACA;AACA;AACA,KAtCA,EAtmBA,E;;;;;;;;;;;;;AC5MA;AAAA;AAAA;AAAA;AAA8/C,CAAgB,+3CAAG,EAAC,C;;;;;;;;;;;ACAlhD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/message/service.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/message/service.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./service.vue?vue&type=template&id=6c8a16c4&\"\nvar renderjs\nimport script from \"./service.vue?vue&type=script&lang=js&\"\nexport * from \"./service.vue?vue&type=script&lang=js&\"\nimport style0 from \"./service.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/message/service.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=template&id=6c8a16c4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"content\" @touchstart=\"hideDrawer\">\r\n\t\t\t<scroll-view class=\"msg-list\" scroll-y=\"true\" :scroll-with-animation=\"scrollAnimation\" :scroll-top=\"scrollTop\" :scroll-into-view=\"scrollToView\" @scrolltoupper=\"loadHistory\" upper-threshold=\"50\">\r\n\t\t\t\t<!-- 加载历史数据waitingUI -->\r\n\t\t\t\t<view class=\"loading\" v-if=\"isHistoryLoading\">\r\n\t\t\t\t\t<view class=\"spinner\">\r\n\t\t\t\t\t\t<view class=\"rect1\"></view>\r\n\t\t\t\t\t\t<view class=\"rect2\"></view>\r\n\t\t\t\t\t\t<view class=\"rect3\"></view>\r\n\t\t\t\t\t\t<view class=\"rect4\"></view>\r\n\t\t\t\t\t\t<view class=\"rect5\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"row\" v-for=\"(row,index) in msgList\" :key=\"index\" :id=\"'msg'+row.msg.id\">\r\n\t\t\t\t\t<!-- 系统消息 -->\r\n\t\t\t\t\t<block v-if=\"row.type=='system'\" >\r\n\t\t\t\t\t\t<view class=\"system\">\r\n\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='text'\" class=\"text\">\r\n\t\t\t\t\t\t\t\t{{row.msg.content.text}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 领取红包消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='redEnvelope'\" class=\"red-envelope\">\r\n\t\t\t\t\t\t\t\t<image src=\"/static/chat/emoticon/red-envelope-chat.png\"></image>\r\n\t\t\t\t\t\t\t\t{{row.msg.content.text}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t\t<!-- 用户消息 -->\r\n\t\t\t\t\t<block v-if=\"row.type=='user'\">\r\n\t\t\t\t\t\t<!-- 自己发出的消息 -->\r\n\t\t\t\t\t\t<view class=\"my\" v-if=\"row.msg.userinfo.uid == myuid\">\r\n\t\t\t\t\t\t\t<!-- 左-消息 -->\r\n\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='text'\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.msg.content.text\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 语言消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='voice'\" class=\"bubble voice\" @tap=\"playVoice(row.msg)\" :class=\"playMsgid == row.msg.id?'play':''\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"length\">{{row.msg.content.length}}</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"icon my-voice\"></view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='img'\" class=\"bubble img\" @tap=\"showPic(row.msg)\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"row.msg.content.url\" :style=\"{'width': row.msg.content.w+'px','height': row.msg.content.h+'px'}\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 红包 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='redEnvelope'\" class=\"bubble red-envelope\" @tap=\"openRedEnvelope(row.msg,index)\">\r\n\t\t\t\t\t\t\t\t\t<image src=\"/static/chat/emoticon/red-envelope.png\"></image>\r\n\t\t\t\t\t\t\t\t\t<view class=\"tis\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- 点击开红包 -->\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"blessing\">\r\n\t\t\t\t\t\t\t\t\t\t{{row.msg.content.blessing}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 右-头像 -->\r\n\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t<image :src=\"row.msg.userinfo.face\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- 别人发出的消息 -->\r\n\t\t\t\t\t\t<view class=\"other\" v-if=\"row.msg.userinfo.uid!=myuid\" style=\"display: inline-block;\">\r\n\t\t\t\t\t\t\t<view class=\"username text-sm flex\" style=\"padding:0rpx 0rpx 10rpx 105rpx;\">\r\n\t\t\t\t\t\t\t\t<view class=\"name\">{{row.msg.userinfo.username}}</view>\r\n\t\t\t\t\t\t\t\t<view class=\"time margin-left-lg\">{{row.msg.time}}</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"flex\">\r\n\t\t\t\t\t\t\t<!-- 左-头像 -->\r\n\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t<image :src=\"row.msg.userinfo.face\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 右-用户名称-时间-消息 -->\r\n\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t<!--<view class=\"username\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"name\">{{row.msg.userinfo.username}}</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"time\">{{row.msg.time}}</view>\r\n\t\t\t\t\t\t\t\t</view>-->\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='text'\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.msg.content.text\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 语音消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='voice'\" class=\"bubble voice\" @tap=\"playVoice(row.msg)\" :class=\"playMsgid == row.msg.id?'play':''\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"icon other-voice\"></view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"length\">{{row.msg.content.length}}</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='img'\" class=\"bubble img\" @tap=\"showPic(row.msg)\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"row.msg.content.url\" :style=\"{'width': row.msg.content.w+'px','height': row.msg.content.h+'px'}\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 红包 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='redEnvelope'\" class=\"bubble red-envelope\" @tap=\"openRedEnvelope(row.msg,index)\">\r\n\t\t\t\t\t\t\t\t\t<image src=\"/static/chat/emoticon/red-envelope.png\"></image>\r\n\t\t\t\t\t\t\t\t\t<view class=\"tis\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- 点击开红包 -->\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"blessing\">\r\n\t\t\t\t\t\t\t\t\t\t{{row.msg.content.blessing}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\t\t<!-- 抽屉栏 -->\r\n\t\t<view class=\"popup-layer\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- 表情 -->\r\n\t\t\t<!-- <swiper class=\"emoji-swiper\"\r\n\t\t\t@animationfinish=\"moveend($event)\"\r\n\t\t\t:class=\"{hidden:hideEmoji}\"\r\n\t\t\tindicator-dots=\"true\"\r\n\t\t\tduration=\"150\"\r\n\t\t\t:current=\"dotsCurrent\"\r\n\t\t\t>\r\n\t\t\t\t<swiper-item v-for=\"(page,pid) in emojiList\" :key=\"pid\">\r\n\t\t\t\t\t<view v-for=\"(em,eid) in page\" :key=\"eid\" @tap=\"addEmoji(em)\">\r\n\t\t\t\t\t\t<image mode=\"widthFix\" :src=\"'/static/img/emoji/'+em.url\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</swiper-item>\r\n\t\t\t</swiper> -->\r\n\t\t\t<!--<emotion @addEmoji=\"addEmoji\" :class=\"{hidden:hideEmoji}\" ></emotion>-->\r\n\t\t\t<!-- 更多功能 相册-拍照-红包 -->\r\n\t\t\t<view class=\"more-layer\" :class=\"{hidden:hideMore}\">\r\n\t\t\t\t<view class=\"list\">\r\n\t\t\t\t\t<view class=\"box\" @tap=\"chooseImage('album')\"><view class=\"icon tupian2\"></view></view>\r\n\t\t\t\t\t<view class=\"box\" @tap=\"chooseImage('camera')\"><view class=\"icon paizhao\"></view></view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 底部输入栏 -->\r\n\t\t<view class=\"input-box\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- H5下不能录音，输入栏布局改动一下 -->\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"voice\">\r\n\t\t\t\t<view class=\"icon\" :class=\"isVoice?'jianpan':'yuyin'\" @tap=\"switchVoice\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<!-- #ifdef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"textbox\">\r\n\t\t\t\t<view class=\"voice-mode\" :class=\"[isVoice?'':'hidden',recording?'recording':'']\" @touchstart=\"voiceBegin\" @touchmove.stop.prevent=\"voiceIng\" @touchend=\"voiceEnd\" @touchcancel=\"voiceCancel\">{{voiceTis}}</view>\r\n\t\t\t\t<view class=\"text-mode\"  :class=\"isVoice?'hidden':''\">\r\n\t\t\t\t\t<view class=\"box\">\r\n\t\t\t\t\t\t<textarea auto-height=\"true\" v-model=\"textMsg\" @focus=\"textareaFocus\"/>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!--<view class=\"em\" >&lt;!&ndash;@tap=\"chooseEmoji\"&ndash;&gt;\r\n\t\t\t\t\t\t<view class=\"icon biaoqing\"></view>\r\n\t\t\t\t\t</view>-->\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"send\" :class=\"isVoice?'hidden':''\" @tap=\"sendText\">\r\n\t\t\t\t<view class=\"btn\">发送</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 录音UI效果 -->\r\n\t\t<view class=\"record\" :class=\"recording?'':'hidden'\">\r\n\t\t\t<view class=\"ing\" :class=\"willStop?'hidden':''\"><view class=\"icon luyin2\" ></view></view>\r\n\t\t\t<view class=\"cancel\" :class=\"willStop?'':'hidden'\"><view class=\"icon chehui\" ></view></view>\r\n\t\t\t<view class=\"tis\" :class=\"willStop?'change':''\">{{recordTis}}</view>\r\n\t\t</view>\r\n\t\t<!-- 红包弹窗 -->\r\n\t\t<view class=\"windows\" :class=\"windowsState\">\r\n\t\t\t<!-- 遮罩层 -->\r\n\t\t\t<view class=\"mask\" @touchmove.stop.prevent=\"discard\" @tap=\"closeRedEnvelope\"></view>\r\n\t\t\t<view class=\"layer\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t\t<view class=\"open-redenvelope\">\r\n\t\t\t\t\t<view class=\"top\">\r\n\t\t\t\t\t\t<view class=\"close-btn\">\r\n\t\t\t\t\t\t\t<view class=\"icon close\" @tap=\"closeRedEnvelope\"></view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<image src=\"/static/img/im/face/face_1.jpg\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"from\">来自{{redenvelopeData.from}}</view>\r\n\t\t\t\t\t<view class=\"blessing\">{{redenvelopeData.blessing}}</view>\r\n\t\t\t\t\t<view class=\"money\">{{redenvelopeData.money}}</view>\r\n\t\t\t\t\t<view class=\"showDetails\" @tap=\"toDetails(redenvelopeData.rid)\">\r\n\t\t\t\t\t\t查看领取详情 <view class=\"icon to\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\n    //import emotion from '@/components/emotion/index.vue'\r\n    import emojiData from \"@/utils/js_sdk/emojiData.js\"\r\n    import {mapMutations,mapState,mapGetters} from 'vuex'\r\n    export default {\r\n        components: {\r\n            //emotion\r\n        },\r\n        data() {\r\n            return {\r\n                kefuData:false,\r\n\t\t\t\tisMsgDown:false,\r\n\t\t\t\tloadFinish:false,\r\n                //文字消息\r\n                // dotsCurrent:1,\r\n                textMsg:'',\r\n                //消息列表\r\n                isHistoryLoading:false,\r\n                scrollAnimation:false,\r\n                scrollTop:0,\r\n                scrollToView:'',\r\n                msgList:[],\r\n                //msgImgList:[],\r\n                myuid:0,\r\n\r\n                //录音相关参数\r\n                // #ifndef H5\r\n                //H5不能录音\r\n                RECORDER:uni.getRecorderManager(),\r\n                // #endif\r\n                isVoice:false,\r\n                voiceTis:'按住 说话',\r\n                recordTis:\"手指上滑 取消发送\",\r\n                recording:false,\r\n                willStop:false,\r\n                initPoint:{identifier:0,Y:0},\r\n                recordTimer:null,\r\n                recordLength:0,\r\n\r\n                //播放语音相关参数\r\n                AUDIO:uni.createInnerAudioContext(),\r\n                playMsgid:null,\r\n                VoiceTimer:null,\r\n                // 抽屉参数\r\n                popupLayerClass:'',\r\n                // more参数\r\n                hideMore:true,\r\n                //表情定义\r\n                hideEmoji:true,\r\n                emojiList:[{}],\r\n                emojiPath:'',\r\n                //表情图片图床名称 ，由于我上传的第三方图床名称会有改变，所以有此数据来做对应，您实际应用中应该不需要\r\n                onlineEmoji:{},\r\n                //红包相关参数\r\n                windowsState:'',\r\n                redenvelopeData:{\r\n                    rid:null,\t//红包ID\r\n                    from:null,\r\n                    face:null,\r\n                    blessing:null,\r\n                    money:null\r\n                }\r\n            };\r\n        },\r\n        onLoad(option) {\r\n\t\t\tthis.initKefu()\r\n            //语音自然播放结束\r\n            this.AUDIO.onEnded((res)=>{ this.playMsgid = null; });\r\n            // #ifndef H5\r\n            //录音开始事件\r\n            this.RECORDER.onStart((e)=>{ this.recordBegin(e); })\r\n            //录音结束事件\r\n            this.RECORDER.onStop((e)=>{ this.recordEnd(e); })\r\n            // #endif\r\n            //this.emojiList = emojiData.imgArr[1].emojiList\r\n        },\r\n\r\n        onShow(){\r\n            this.scrollTop = 9999999;\r\n\r\n            //模板借由本地缓存实现发红包效果，实际应用中请不要使用此方法。\r\n            uni.getStorage({\r\n                key: 'redEnvelopeData',\r\n                success: (res)=>{\r\n                    // console.log(res.data);\r\n                    let nowDate = new Date();\r\n                    let lastid = this.msgList[this.msgList.length-1].msg.id;\r\n                    lastid++;\r\n                    let row = {type:\"user\",msg:{id:lastid,type:\"redEnvelope\",time:nowDate.getHours()+\":\"+nowDate.getMinutes(),userinfo:{uid:0,username:\"大黑哥\",face:\"/static/img/face.jpg\"},content:{blessing:res.data.blessing,rid:Math.floor(Math.random()*1000+1),isReceived:false}}};\r\n                    this.screenMsg(row);\r\n                    uni.removeStorage({key: 'redEnvelopeData'});\r\n                }\r\n            });\r\n        },\r\n        methods:{\r\n            initKefu(){\r\n                this.myuid = this.userInfo.id\r\n                this.connectService()\r\n                this.getMsgList();\r\n\t\t\t},\r\n\t\t\tconnectService(){\r\n                let msg = {scene:'kefu',pages:'message_service.msgList',type:'login',uniacid:1,token:this.$store.getters.token}\r\n                if(this.$Route.query.role == 'kefu') {\r\n                    msg.role = 'kefu'\r\n                    msg.roomid = this.$Route.query.roomid\r\n                }\r\n                this.$socket.nsend(JSON.stringify(msg))\r\n\t\t\t},\r\n            screenMsg(msg){\r\n\t\t\t\tlet sendMsg = {scene:'kefu',toUser:'system',uniacid:1,content:1}\r\n                this.$socket.nsend(JSON.stringify(sendMsg))\r\n\t\t\t    return false;\r\n                //从长连接处转发给这个方法，进行筛选处理\r\n                if(msg.type=='system'){\r\n                    switch (msg.msg.type){\r\n                        case 'text':\r\n                            this.addSystemTextMsg(msg);\r\n                            break;\r\n                        case 'redEnvelope':\r\n                            this.addSystemRedEnvelopeMsg(msg);\r\n                            break;\r\n                    }\r\n                }else if(msg.type=='user'){\r\n                    switch (msg.msg.type){\r\n                        case 'text':\r\n                            this.msgList.push(msg);\r\n                            break;\r\n                        case 'voice':\r\n                            this.msgList.push(msg);\r\n                            break;\r\n                        case 'img':\r\n                            this.addImgMsg(msg);\r\n                            break;\r\n                        case 'redEnvelope':\r\n                            this.addRedEnvelopeMsg(msg);\r\n                            break;\r\n                    }\r\n                    //非自己的消息震动\r\n                    if(msg.msg.userinfo.uid!=this.myuid){\r\n                        // console.log('振动');\r\n                        uni.vibrateLong();\r\n                    }\r\n                }\r\n                this.$nextTick(function() {\r\n                    // 滚动到底\r\n                    this.scrollToView = 'msg'+msg.msg.id\r\n                });\r\n            },\r\n            //触发滑动到顶部(加载历史信息记录)\r\n            loadHistory(e){\r\n                this.isMsgDown = false\r\n                if(this.isHistoryLoading) return false;\r\n                this.isHistoryLoading = true;\r\n                this.scrollAnimation = false;\r\n\r\n                let msg = {scene:'kefu',pages:this.$Route.name+'.msgList',type:'record',uniacid:1,token:this.$store.getters.token}\r\n                if(this.$Route.query.role == 'kefu') {\r\n                    msg.role = 'kefu'\r\n                    msg.roomid = this.$Route.query.roomid\r\n                }\r\n                if(this.msgList[0]){\r\n                    msg.content = this.msgList[0]\r\n\t\t\t\t}\r\n\r\n                this.isMsgDown = this.msgList[0]['msg']['id']\r\n                setTimeout(()=>{\r\n                    if(this.loadFinish){\r\n                        this.isMsgDown = false\r\n                        this.isHistoryLoading = false;\r\n                        this.scrollAnimation = false;\r\n                        this.$utils.toast('无更多聊天记录')\r\n                        return false;\r\n                    }\r\n                    this.$socket.nsend(JSON.stringify(msg))\r\n\t\t\t\t},1000)\r\n                return false;\r\n                if(this.isHistoryLoading) return false;\r\n                this.isHistoryLoading = true;//参数作为进入请求标识，防止重复请求\r\n                this.scrollAnimation = false;//关闭滑动动画\r\n                let Viewid = this.msgList[0].msg.id;//记住第一个信息ID\r\n                //本地模拟请求历史记录效果\r\n                setTimeout(()=>{\r\n                    let msg = {scene:'kefu',pages:this.$Route.name+'.msgList',type:'record',uniacid:1,token:this.$store.getters.token}\r\n                    if(this.$Route.query.role == 'kefu') {\r\n                        msg.role = 'kefu'\r\n                        msg.roomid = this.$Route.query.roomid\r\n                    }\r\n                    this.$socket.nsend(JSON.stringify(msg))\r\n                    // 消息列表\r\n                    let list = [\r\n                        //{type:\"user\",msg:{id:1,type:\"text\",time:\"12:56\",userinfo:{uid:0,username:\"大黑哥\",face:\"/static/chat/emoticon/face.jpg\"},content:{text:\"为什么温度会相差那么大？\"}}},\r\n                        //{type:\"user\",msg:{id:2,type:\"text\",time:\"12:57\",userinfo:{uid:1,username:\"售后客服008\",face:\"/static/chat/emoticon/face/face_2.jpg\"},content:{text:\"这个是有偏差的，两个温度相差十几二十度是很正常的，如果相差五十度，那即是质量问题了。\"}}},\r\n                        //{type:\"user\",msg:{id:3,type:\"voice\",time:\"12:59\",userinfo:{uid:1,username:\"售后客服008\",face:\"/static/chat/emoticon/face/face_2.jpg\"},content:{url:\"/static/voice/1.mp3\",length:\"00:06\"}}},\r\n                        //{type:\"user\",msg:{id:4,type:\"voice\",time:\"13:05\",userinfo:{uid:0,username:\"大黑哥\",face:\"/static/chat/emoticon/face.jpg\"},content:{url:\"/static/voice/2.mp3\",length:\"00:06\"}}},\r\n                    ]\r\n                    // 获取消息中的图片,并处理显示尺寸\r\n                    for(let i=0;i<list.length;i++){\r\n                        if(list[i].type=='user'&&list[i].msg.type==\"img\"){\r\n                            list[i].msg.content = this.setPicSize(list[i].msg.content);\r\n                            this.msgImgList.unshift(list[i].msg.content.url);\r\n                        }\r\n                        list[i].msg.id = Math.floor(Math.random()*1000+1);\r\n                        this.msgList.unshift(list[i]);\r\n                    }\r\n\r\n                    //这段代码很重要，不然每次加载历史数据都会跳到顶部\r\n                    this.$nextTick(function() {\r\n                        this.scrollToView = 'msg'+Viewid;//跳转上次的第一行信息位置\r\n                        this.$nextTick(function() {\r\n                            this.scrollAnimation = true;//恢复滚动动画\r\n                        });\r\n\r\n                    });\r\n                    this.isHistoryLoading = false;\r\n\r\n                },1000)\r\n            },\r\n            //初始化页面时获取前10条信息\r\n            getMsgList(){\r\n                let msg = {scene:'kefu',pages:this.$Route.name+'.msgList',type:'record',uniacid:1,token:this.$store.getters.token}\r\n                if(this.$Route.query.role == 'kefu') {\r\n                    msg.role = 'kefu'\r\n                    msg.roomid = this.$Route.query.roomid\r\n                }\r\n                this.$socket.nsend(JSON.stringify(msg))\r\n                /*this.$nextTick(() => {\r\n                    //进入页面滚动到底部\r\n                    this.scrollTop = 9999;\r\n                    this.$nextTick(() => {\r\n                        this.scrollAnimation = true;\r\n                    });\r\n\r\n                });\r\n                setTimeout(()=>{\r\n                    this.scrollTop = 9999;\r\n                    this.$nextTick(() => {\r\n                        this.scrollAnimation = true;\r\n                    });\r\n\t\t\t\t},3000)*/\r\n\t\t\t\treturn false;\r\n                let list = [\r\n                    {type:\"system\",msg:{id:0,type:\"text\",content:{text:\"欢迎进入聊天室\"}}},\r\n                    {type:\"user\",msg:{id:1,type:\"text\",time:\"12:56\",userinfo:{uid:0,username:\"大黑哥\",face:\"/static/chat/emoticon/face.jpg\"},content:{text:\"为什么温度会相差那么大？\"}}},\r\n                    {type:\"user\",msg:{id:2,type:\"text\",time:\"12:57\",userinfo:{uid:1,username:\"售后客服008\",face:\"/static/chat/emoticon/im/face/face_2.jpg\"},content:{text:\"这个是有偏差的，两个温度相差十几二十度是很正常的，如果相差五十度，那即是质量问题了。\"}}},\r\n                    {type:\"user\",msg:{id:3,type:\"voice\",time:\"12:59\",userinfo:{uid:1,username:\"售后客服008\",face:\"/static/chat/emoticon/im/face/face_2.jpg\"},content:{url:\"/static/voice/1.mp3\",length:\"00:06\"}}},\r\n                    {type:\"user\",msg:{id:4,type:\"voice\",time:\"13:05\",userinfo:{uid:0,username:\"大黑哥\",face:\"/static/chat/emoticon/face.jpg\"},content:{url:\"/static/voice/2.mp3\",length:\"00:06\"}}},\r\n                    {type:\"user\",msg:{id:5,type:\"img\",time:\"13:05\",userinfo:{uid:0,username:\"大黑哥\",face:\"/static/chat/emoticon/im/face/face.jpg\"},content:{url:\"/static/img/p10.jpg\",w:200,h:200}}},\r\n                    {type:\"user\",msg:{id:6,type:\"img\",time:\"12:59\",userinfo:{uid:1,username:\"售后客服008\",face:\"/static/chat/emoticon/im/face/face_2.jpg\"},content:{url:\"/static/img/q.jpg\",w:1920,h:1080}}},\r\n                    {type:\"system\",msg:{id:7,type:\"text\",content:{text:\"欢迎进入聊天室\"}}},\r\n\r\n                    {type:\"system\",msg:{id:9,type:\"redEnvelope\",content:{text:\"售后客服008领取了你的红包\"}}},\r\n                    {type:\"user\",msg:{id:10,type:\"redEnvelope\",time:\"12:56\",userinfo:{uid:0,username:\"大黑哥\",face:\"/static/chat/emoticon/im/face/face.jpg\"},content:{blessing:\"恭喜发财，大吉大利，万事如意\",rid:0,isReceived:false}}},\r\n                    {type:\"user\",msg:{id:11,type:\"redEnvelope\",time:\"12:56\",userinfo:{uid:1,username:\"售后客服008\",face:\"/static/chat/emoticon/im/face/face_2.jpg\"},content:{blessing:\"恭喜发财\",rid:1,isReceived:false}}},\r\n                ]\r\n                // 获取消息中的图片,并处理显示尺寸\r\n                for(let i=0;i<list.length;i++){\r\n                    if(list[i].type=='user'&&list[i].msg.type==\"img\"){\r\n                        list[i].msg.content = this.setPicSize(list[i].msg.content);\r\n                        this.msgImgList.push(list[i].msg.content.url);\r\n                    }\r\n                }\r\n                this.msgList = list;\r\n                // 滚动到底部\r\n                this.$nextTick(function() {\r\n                    //进入页面滚动到底部\r\n                    this.scrollTop = 9999;\r\n                    this.$nextTick(function() {\r\n                        this.scrollAnimation = true;\r\n                    });\r\n\r\n                });\r\n            },\r\n            //处理图片尺寸，如果不处理宽高，新进入页面加载图片时候会闪\r\n            setPicSize(content){\r\n                // 让图片最长边等于设置的最大长度，短边等比例缩小，图片控件真实改变，区别于aspectFit方式。\r\n                let maxW = uni.upx2px(350);//350是定义消息图片最大宽度\r\n                let maxH = uni.upx2px(350);//350是定义消息图片最大高度\r\n                if(content.w>maxW||content.h>maxH){\r\n                    let scale = content.w/content.h;\r\n                    content.w = scale>1?maxW:maxH*scale;\r\n                    content.h = scale>1?maxW/scale:maxH;\r\n                }\r\n                return content;\r\n            },\r\n\r\n            //更多功能(点击+弹出)\r\n            showMore(){\r\n                this.isVoice = false;\r\n                this.hideEmoji = true;\r\n                if(this.hideMore){\r\n                    this.hideMore = false;\r\n                    this.openDrawer();\r\n                }else{\r\n                    this.hideDrawer();\r\n                }\r\n            },\r\n            // 打开抽屉\r\n            openDrawer(){\r\n                this.popupLayerClass = 'showLayer';\r\n            },\r\n            // 隐藏抽屉\r\n            hideDrawer(){\r\n                this.popupLayerClass = '';\r\n                setTimeout(()=>{\r\n                    this.hideMore = true;\r\n                    this.hideEmoji = true;\r\n                },150);\r\n            },\r\n            //发红包\r\n            handRedEnvelopes(){\r\n                uni.navigateTo({\r\n                    url:'HM-hand/HM-hand'\r\n                });\r\n                this.hideDrawer();\r\n            },\r\n            //选照片 or 拍照\r\n            chooseImage(type){\r\n                this.hideDrawer();\r\n                uni.chooseImage({\r\n                    sourceType:[type],\r\n                    sizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\r\n                    success: (result)=>{\r\n                        uni.getImageInfo({\r\n                            src: result.tempFilePaths[0],\r\n                            success: (image)=>{\r\n                                let tempFilePaths = result.tempFilePaths[0];\r\n                                this.$http.upload('util.uploader.upload',{filePath:tempFilePaths,name:'file'}).then((res)=>{\r\n                                    let url = res.files[0].url\r\n                                    let msg = {url:url,w:image.width,h:image.height};\r\n                                    this.sendMsg(msg,'img');\r\n                                }).catch((err)=>{\r\n                                    this.$utils.toast('图片上传失败')\r\n                                })\r\n\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            },\r\n\r\n\r\n            //获取焦点，如果不是选表情ing,则关闭抽屉\r\n            textareaFocus(){\r\n                if(this.popupLayerClass=='showLayer' && this.hideMore == false){\r\n                    this.hideDrawer();\r\n                }\r\n            },\r\n            // 发送文字消息\r\n            sendText(){\r\n                this.hideDrawer();\r\n                if(!this.textMsg) return false;\r\n                //let content = this.replaceEmoji(this.textMsg);\r\n                //let content = this.textMsg\r\n                let msg = {text:this.textMsg}\r\n                this.sendMsg(msg,'text');\r\n                this.textMsg = '';\r\n            },\r\n            //替换表情符号为图片\r\n            replaceEmoji(str){\r\n                // 正则表达式匹配内容\r\n                let replacedStr = str.replace(/\\[([^(\\]|\\[)]*)\\]/g,(item, index)=>{\r\n                    // console.log(\"item: \" + item);\r\n                    for(let i=0;i<this.emojiList.length;i++){\r\n                        let row = this.emojiList[i];\r\n                        for(let j=0;j<row.length;j++){\r\n                            let EM = row[j];\r\n                            if(EM.alt==item){\r\n                                //在线表情路径，图文混排必须使用网络路径，请上传一份表情到你的服务器后再替换此路径\r\n                                //比如你上传服务器后，你的100.gif路径为https://www.xxx.com/emoji/100.gif 则替换onlinePath填写为https://www.xxx.com/emoji/\r\n                                // let onlinePath = 'https://s2.ax1x.com/2019/04/12/'\r\n                                // let imgstr = '<image src=\"'+onlinePath+this.onlineEmoji[EM.url]+'\">';\r\n\r\n                                let onlinePath=this.emojiPath\r\n                                let imgstr = '<img style=\"width:24px;height:24px;\" src=\"'+onlinePath+EM.url+'\">';\r\n                                // console.log(\"imgstr: \" + imgstr);\r\n                                return imgstr;\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                return '<div style=\"align-items: center;word-wrap:break-word;\">'+replacedStr+'</div>';\r\n            },\r\n\r\n            // 发送消息\r\n            sendMsg(content,type){\r\n                let msg = {scene:'kefu',pages:this.$Route.name+'.msgList',type:type,uniacid:1,token:this.$store.getters.token,content:content}\r\n                if(this.$Route.query.role == 'kefu') {\r\n                    msg.role = 'kefu'\r\n                    msg.roomid = this.$Route.query.roomid\r\n                }\r\n                this.$socket.nsend(JSON.stringify(msg))\r\n\t\t\t\treturn false;\r\n            },\r\n\r\n            // 添加文字消息到列表\r\n            addTextMsg(msg){\r\n                this.msgList.push(msg);\r\n            },\r\n            // 添加语音消息到列表\r\n            addVoiceMsg(msg){\r\n                this.msgList.push(msg);\r\n            },\r\n            // 添加图片消息到列表\r\n            addImgMsg(msg){\r\n                msg.msg.content = this.setPicSize(msg.msg.content);\r\n                this.msgImgList.push(msg.msg.content.url);\r\n                this.msgList.push(msg);\r\n            },\r\n            addRedEnvelopeMsg(msg){\r\n                this.msgList.push(msg);\r\n            },\r\n            // 添加系统文字消息到列表\r\n            addSystemTextMsg(msg){\r\n                this.msgList.push(msg);\r\n            },\r\n            // 添加系统红包消息到列表\r\n            addSystemRedEnvelopeMsg(msg){\r\n                this.msgList.push(msg);\r\n            },\r\n            // 打开红包\r\n            openRedEnvelope(msg,index){\r\n                let rid = msg.content.rid;\r\n                uni.showLoading({\r\n                    title:'加载中...'\r\n                });\r\n                // console.log(\"index: \" + index);\r\n                //模拟请求服务器效果\r\n                setTimeout(()=>{\r\n                    //加载数据\r\n                    if(rid==0){\r\n                        this.redenvelopeData={\r\n                            rid:0,\t//红包ID\r\n                            from:\"大黑哥\",\r\n                            face:\"/static/img/im/face/face.jpg\",\r\n                            blessing:\"恭喜发财，大吉大利\",\r\n                            money:\"已领完\"\r\n                        }\r\n                    }else{\r\n                        this.redenvelopeData={\r\n                            rid:1,\t//红包ID\r\n                            from:\"售后客服008\",\r\n                            face:\"/static/img/im/face/face_2.jpg\",\r\n                            blessing:\"恭喜发财\",\r\n                            money:\"0.01\"\r\n                        }\r\n                        if(!msg.content.isReceived){\r\n                            // {type:\"system\",msg:{id:8,type:\"redEnvelope\",content:{text:\"你领取了售后客服008的红包\"}}},\r\n                            this.sendSystemMsg({text:\"你领取了\"+(msg.userinfo.uid==this.myuid?\"自己\":msg.userinfo.username)+\"的红包\"},'redEnvelope');\r\n                            // console.log(\"this.msgList[index]: \" + JSON.stringify(this.msgList[index]));\r\n                            this.msgList[index].msg.content.isReceived = true;\r\n                        }\r\n                    }\r\n                    uni.hideLoading();\r\n                    this.windowsState = 'show';\r\n\r\n                },200)\r\n\r\n            },\r\n            // 关闭红包弹窗\r\n            closeRedEnvelope(){\r\n                this.windowsState = 'hide';\r\n                setTimeout(()=>{\r\n                    this.windowsState = '';\r\n                },200)\r\n            },\r\n            sendSystemMsg(content,type){\r\n                let lastid = this.msgList[this.msgList.length-1].msg.id;\r\n                lastid++;\r\n                let row = {type:\"system\",msg:{id:lastid,type:type,content:content}};\r\n                this.screenMsg(row)\r\n            },\r\n            //领取详情\r\n            toDetails(rid){\r\n                uni.navigateTo({\r\n                    url:'HM-details/HM-details?rid='+rid\r\n                })\r\n            },\r\n            // 预览图片\r\n            showPic(msg){\r\n                uni.previewImage({\r\n                    indicator:\"none\",\r\n                    current:msg.content.url,\r\n                    urls: this.msgImgList\r\n                });\r\n            },\r\n            // 播放语音\r\n            playVoice(msg){\r\n                this.playMsgid=msg.id;\r\n                this.AUDIO.src = msg.content.url;\r\n                this.$nextTick(function() {\r\n                    this.AUDIO.play();\r\n                });\r\n            },\r\n            // 录音开始\r\n            voiceBegin(e){\r\n                let permision = this.$utils.permision.requestAndroidPermission('android.permission.RECORD_AUDIO')\r\n                if(permision==-1){\r\n                    uni.showModal({\r\n                        title: '提示',\r\n                        content: '已被拒绝麦克风权限,是否前往打开?',\r\n                        success:  (res) => {\r\n                            if (res.confirm) {\r\n                                this.$utils.permision.gotoAppPermissionSetting()\r\n                                return false;\r\n                            } else if (res.cancel) {\r\n                                this.$utils.toast('麦克风权限被拒绝')\r\n                                return false;\r\n                            }\r\n                        }\r\n                    })\r\n                }else if(permision==0){\r\n                    uni.showModal({\r\n                        title: '提示',\r\n                        content: '已被拒绝麦克风权限,是否前往打开?',\r\n                        success:  (res) => {\r\n                            if (res.confirm) {\r\n                                this.$utils.permision.gotoAppPermissionSetting()\r\n                                return false;\r\n                            } else if (res.cancel) {\r\n                                this.$utils.toast('麦克风权限被拒绝')\r\n                                return false;\r\n                            }\r\n                        }\r\n                    })\r\n                }else{\r\n                    if(e.touches.length>1) return false;\r\n                    this.initPoint.Y = e.touches[0].clientY;\r\n                    this.initPoint.identifier = e.touches[0].identifier;\r\n                    this.RECORDER.start({format:\"mp3\"});\r\n\t\t\t\t}\r\n\r\n            },\r\n            //录音开始UI效果\r\n            recordBegin(e){\r\n                this.recording = true;\r\n                this.voiceTis='松开 结束';\r\n                this.recordLength = 0;\r\n                this.recordTimer = setInterval(()=>{\r\n                    this.recordLength++;\r\n                },1000)\r\n            },\r\n            // 录音被打断\r\n            voiceCancel(){\r\n                this.recording = false;\r\n                this.voiceTis='按住 说话';\r\n                this.recordTis = '手指上滑 取消发送'\r\n                this.willStop = true;//不发送录音\r\n                this.RECORDER.stop();//录音结束\r\n            },\r\n            // 录音中(判断是否触发上滑取消发送)\r\n            voiceIng(e){\r\n                if(!this.recording) return false;\r\n                let touche = e.touches[0];\r\n                //上滑一个导航栏的高度触发上滑取消发送\r\n                if(this.initPoint.Y - touche.clientY>=uni.upx2px(100)){\r\n                    this.willStop = true;\r\n                    this.recordTis = '松开手指 取消发送'\r\n                }else{\r\n                    this.willStop = false;\r\n                    this.recordTis = '手指上滑 取消发送'\r\n                }\r\n            },\r\n            // 结束录音\r\n            voiceEnd(e){\r\n                if(!this.recording) return false;\r\n                this.recording = false;\r\n                this.voiceTis='按住 说话';\r\n                this.recordTis = '手指上滑 取消发送'\r\n                this.RECORDER.stop();\r\n            },\r\n            //录音结束(回调文件) 先上传录音文件再生成两条天记录\r\n            recordEnd(e){\r\n                clearInterval(this.recordTimer);\r\n                if(!this.willStop){\r\n                    this.$http.upload('util.uploader.upload',{filePath:e.tempFilePath,name:'file',params:{type:'voice'}}).then((res)=>{\r\n                        let url = res.files[0].url\r\n                        let innerAudioContext = uni.createInnerAudioContext();\r\n                        innerAudioContext.src = e.tempFilePath\r\n                        innerAudioContext.onCanplay((playRes)=>{\r\n                            let msg = {length:'00:01',url:url}\r\n                            let recordLength = Math.ceil(innerAudioContext.duration)\r\n                            let min = parseInt(recordLength/60);\r\n                            let sec = recordLength % 60;\r\n                            min = min<10?'0'+min:min;\r\n                            sec = sec<10?'0'+sec:sec;\r\n                            msg.length = min+':'+sec;\r\n                            console.log('msg',msg)\r\n                            this.sendMsg(msg,'voice');\r\n                        })\r\n                    }).catch((err)=>{\r\n                        console.log('err',err)\r\n                        this.$utils.toast('发送失败')\r\n                    })\r\n                }else{\r\n                    //console.log('取消发送录音');\r\n                }\r\n                this.willStop = false;\r\n            },\r\n            // 切换语音/文字输入\r\n            switchVoice(){\r\n                this.hideDrawer();\r\n                this.isVoice = this.isVoice?false:true;\r\n            },\r\n            discard(){\r\n                return;\r\n            }\r\n        },\r\n        computed: {\r\n            msgImgList(){\r\n                let msgImgList = []\r\n\t\t\t\tthis.msgList.forEach((item,index)=>{\r\n\t\t\t\t\tif(item.msg.type=='img') msgImgList.push(item.msg.content.url)\r\n\t\t\t\t})\r\n\t\t\t\treturn msgImgList\r\n\t\t\t},\r\n            ...mapState(['SocketState']),\r\n            ...mapGetters(['userInfo'])\r\n        },\r\n        watch: {\r\n            'SocketState.message_service': {\r\n                handler(newVal,oldVal) {\r\n                    Object.keys(newVal).forEach((key)=>{\r\n                        console.log(key,newVal[key])\r\n                        this.$set(this,key,newVal[key])\r\n                    });\r\n                },\r\n                immediate: true,\r\n                deep: true\r\n\t\t\t},\r\n\r\n            msgList(newVal,oldVal){\r\n                console.log('newVal',newVal)\r\n                this.isHistoryLoading = false\r\n                this.scrollAnimation = false\r\n                if(this.isMsgDown) {\r\n                    this.$nextTick(()=>{\r\n                        this.scrollToView = \"msg\"+this.isMsgDown\r\n                        console.log('isMsgDown',this.scrollToView)\r\n                        this.isMsgDown = false\r\n                    });\r\n                    return false;\r\n                }\r\n                setTimeout(()=>{\r\n                    this.$nextTick(()=>{\r\n                        //this.scrollToView = 'msg279aca7fea3b16561c70af029eb01fa3'\r\n                        this.scrollToView = \"msg\"+(newVal[newVal.length - 1]?newVal[newVal.length - 1]['msg']['id']:0)\r\n                        console.log('scrollToView',this.scrollToView)\r\n\t\t\t\t\t})\r\n\t\t\t\t},0)\r\n\r\n\t\t\t},\r\n            loadFinish(newVal,oldVal){\r\n                if(newVal){\r\n                    this.isHistoryLoading = false\r\n                    this.scrollAnimation = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n        },\r\n    }\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import \"@/static/css/hm-chat.scss\";\r\n\r\n</style>","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1624239439053\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}